<!-- Scripts -->
    <!-- theme.js को रहने दें, हम सिर्फ़ नीचे के <script> ब्लॉक को बदल रहे हैं -->
    <script src="theme.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- 1. Navigation and Theme Toggle Logic (Existing Code) ---
            const allToolsBtn = document.getElementById('allToolsBtn');
            const hamburgerBtn = document.getElementById('hamburgerBtn');
            const allToolsMenu = document.getElementById('allToolsMenu');
            const searchBtn = document.getElementById('searchBtn');

            const toggleMenu = (event) => { event.stopPropagation(); allToolsMenu.classList.toggle('show'); allToolsBtn.classList.toggle('open'); };
            allToolsBtn.addEventListener('click', toggleMenu);
            hamburgerBtn.addEventListener('click', () => {
                allToolsMenu.classList.toggle('show');
                document.body.classList.toggle('menu-open');
            });
            document.addEventListener('click', (event) => {
                if (window.innerWidth > 900) {
                    if (allToolsMenu.classList.contains('show') && !allToolsMenu.contains(event.target) && !event.target.closest('.main-nav')) {
                        allToolsMenu.classList.remove('show'); allToolsBtn.classList.remove('open');
                    }
                } else {
                    if (allToolsMenu.classList.contains('show') && !allToolsMenu.contains(event.target) && event.target !== hamburgerBtn) {
                        allToolsMenu.classList.remove('show');
                        document.body.classList.remove('menu-open');
                    }
                }
            });

            // --- 2. PWA Install Logic (Existing Code) ---
            let deferredPrompt;
            const installButton = document.getElementById('installButton');

            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                installButton.style.display = 'block';
            });

            installButton.addEventListener('click', () => {
                installButton.style.display = 'none';
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    deferredPrompt.userChoice.then((choiceResult) => {
                        console.log('User response to install prompt:', choiceResult.outcome);
                        deferredPrompt = null;
                    });
                }
            });

            window.addEventListener('appinstalled', () => {
                installButton.style.display = 'none';
            });

            // --- 3. NEW Search and Category Filter Logic ---

            // Step 3a: Get all necessary elements
            const heroSearchInput = document.getElementById('heroSearchInput');
            // Select all tool cards in the main grid and popular tools section
            const toolCards = document.querySelectorAll('.tool-grid-home .tool-card-home');
            const filterTabsContainer = document.getElementById('filterTabs');
            const tabButtons = filterTabsContainer ? filterTabsContainer.querySelectorAll('.tab-btn') : [];
            let activeCategory = 'all'; // Default filter state

            /**
             * applyFilters function:
             * यह फंक्शन दो काम करता है:
             * 1. सर्च इनपुट से टेक्स्ट लेता है.
             * 2. एक्टिव कैटेगरी टैब (activeCategory) को चेक करता है.
             * 3. उन कार्ड्स को दिखाता है जो दोनों से मैच करते हैं (search and category filter).
             */
            function applyFilters() {
                // Get current search term, convert to lowercase for comparison
                const searchTerm = heroSearchInput.value.toLowerCase().trim();

                toolCards.forEach(card => {
                    // Get data-category from card (e.g., "image", "text")
                    const cardCategory = card.getAttribute('data-category');
                    // Get data-keywords from card for searching (e.g., "image pdf jpg png convert")
                    const cardKeywords = card.getAttribute('data-keywords').toLowerCase();

                    // 1. Check if the card matches the currently active category filter
                    // If activeCategory is 'all', then all categories match. Otherwise, check for specific match.
                    const categoryMatch = (activeCategory === 'all' || cardCategory === activeCategory);

                    // 2. Check if the card matches the search term (keywords)
                    // If searchTerm is empty, all cards match. Otherwise, check if keywords contain search term.
                    const searchMatch = (searchTerm === '' || cardKeywords.includes(searchTerm));

                    // 3. Display the card if both category and search conditions are met
                    if (categoryMatch && searchMatch) {
                        card.style.display = 'block';
                    } else {
                        card.style.display = 'none';
                    }
                });
            }

            // --- Event Listeners for new functionality ---

            // Step 3b: Event Listener for Search Input
            // जब भी यूज़र कुछ टाइप करेगा, applyFilters() फंक्शन अपने आप चल जाएगा.
            if (heroSearchInput) {
                heroSearchInput.addEventListener('input', applyFilters);
            }

            // Step 3c: Event Listener for Category Tabs
            // जब भी यूज़र किसी कैटेगरी बटन पर क्लिक करेगा, activeCategory अपडेट होगा और फिर फ़िल्टर चलेगा.
            if (filterTabsContainer) {
                tabButtons.forEach(button => {
                    button.addEventListener('click', () => {
                        // 1. Remove active class from all buttons and add to the clicked one
                        tabButtons.forEach(btn => btn.classList.remove('active'));
                        button.classList.add('active');

                        // 2. Update the active filter state based on the button's data-filter value
                        activeCategory = button.getAttribute('data-filter');

                        // 3. Apply filters again to update the displayed cards
                        applyFilters();
                    });
                });
            }
        });
    </script>
