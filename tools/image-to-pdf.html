<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Image to PDF Converter | ToolMancer</title>
  <link rel="stylesheet" href="../style.css"/>
  <style>
    body {
      background: #f6f6fa;
    }
    .pdf-tool-flex {
      display: flex;
      flex-wrap: wrap;
      gap: 2.5rem;
      justify-content: center;
      align-items: flex-start;
      margin-top: 2.5rem;
    }
    .pdf-images {
      flex: 1 1 320px;
      min-width: 300px;
      max-width: 420px;
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 3px 24px #0001;
      padding: 1.7rem 1.2rem;
      text-align: center;
      position: relative;
      min-height: 280px;
    }
    .pdf-images .add-btn {
      position: absolute;
      right: 1.5rem;
      top: 1.2rem;
      background: #ef4444;
      color: #fff;
      border: none;
      border-radius: 50%;
      width: 45px; height: 45px;
      font-size: 2rem;
      display: flex; align-items: center; justify-content: center;
      box-shadow: 0 2px 7px #0002;
      cursor: pointer;
      transition: background 0.15s;
    }
    .pdf-images .add-btn:hover {
      background: #c81e1e;
    }
    .img-list {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1.2em;
      margin-top: 2.2em;
      margin-bottom: 1.2em;
    }
    .img-thumb {
      border-radius: 12px;
      box-shadow: 0 1px 6px #0002;
      border: 1.5px solid #e6e6e9;
      width: 120px;
      background: #fafaff;
      display: block;
      margin: 0 auto 0.4em auto;
    }
    .img-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      font-size: 1em;
      gap: 0.3em;
    }
    .img-filename {
      font-size: 0.97em;
      color: #222;
      text-align: center;
      max-width: 130px;
      overflow-x: auto;
    }
    /* PDF options panel */
    .pdf-options {
      flex: 1 1 290px;
      min-width: 260px;
      max-width: 350px;
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 3px 24px #0001;
      padding: 2rem 1.3rem 1.5rem 1.3rem;
      display: flex;
      flex-direction: column;
      gap: 1.4em;
    }
    .pdf-opt-label {
      font-weight: bold;
      font-size: 1.07em;
      margin-bottom: 0.35em;
      color: #333;
    }
    .pdf-opt-group {
      display: flex;
      gap: 1em;
      margin-bottom: 0.4em;
    }
    .pdf-opt-btn {
      background: #fff;
      border: 2px solid #e6e6ee;
      color: #222;
      border-radius: 10px;
      padding: 0.8em 1.6em;
      font-size: 1.06em;
      font-weight: 500;
      cursor: pointer;
      transition: border 0.16s, color 0.15s, background 0.15s;
    }
    .pdf-opt-btn.active, .pdf-opt-btn:focus {
      border-color: #ef4444;
      color: #ef4444;
      background: #fff5f5;
    }
    .pdf-opt-btn:not(.active):hover {
      background: #fafbfc;
    }
    .pdf-opt-dropdown {
      width: 100%;
      padding: 0.75em 1em;
      border-radius: 8px;
      border: 2px solid #e6e6ee;
      font-size: 1.05em;
    }
    .pdf-checkbox {
      accent-color: #ef4444;
      width: 1.2em;
      height: 1.2em;
      margin-right: 0.65em;
      vertical-align: middle;
    }
    .pdf-main-btn {
      margin-top: 1.7em;
      padding: 1.15em 0;
      width: 100%;
      font-size: 1.3em;
      border-radius: 13px;
      background: #ef4444;
      color: #fff;
      border: none;
      font-weight: bold;
      box-shadow: 0 5px 24px #ef44441a;
      cursor: pointer;
      transition: background 0.13s, box-shadow 0.15s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.7em;
    }
    .pdf-main-btn:active, .pdf-main-btn:hover {
      background: #c81e1e;
    }
    @media (max-width: 900px) {
      .pdf-tool-flex {
        flex-direction: column;
        gap: 1.3rem;
        align-items: stretch;
        margin-top: 1.1rem;
      }
      .pdf-images, .pdf-options {
        max-width: 96vw;
        margin: 0 auto;
      }
      .pdf-options {
        padding: 1.2rem 0.5rem 1.1rem 0.5rem;
      }
    }
    @media (max-width: 600px) {
      .pdf-images, .pdf-options { min-width: unset; }
      .img-thumb { width: 85px; }
      .img-filename { font-size: 0.93em; max-width: 86px;}
      .pdf-opt-btn { padding: 0.7em 0.7em; font-size: 0.99em;}
      .pdf-main-btn { font-size: 1.07em; border-radius: 8px; padding: 0.85em 0;}
    }
  </style>
</head>
<body>
  <main>
    <div class="pdf-tool-flex">
      <div class="pdf-images" id="pdfImages">
        <button class="add-btn" id="addImgBtn" title="Add Image">+</button>
        <input type="file" id="imgInput" accept="image/*" multiple style="display:none"/>
        <div class="img-list" id="imgList"></div>
        <div id="noImgMsg" style="color:#888; margin-top:2em;">No images selected</div>
      </div>
      <form class="pdf-options" id="pdfOptions" onsubmit="return false;">
        <div>
          <div class="pdf-opt-label">Page orientation</div>
          <div class="pdf-opt-group">
            <button type="button" class="pdf-opt-btn active" data-orient="portrait" id="orientPortrait">Portrait</button>
            <button type="button" class="pdf-opt-btn" data-orient="landscape" id="orientLandscape">Landscape</button>
          </div>
        </div>
        <div>
          <div class="pdf-opt-label">Page size</div>
          <select class="pdf-opt-dropdown" id="pageSize">
            <option value="a4">A4 (297x210 mm)</option>
            <option value="letter">Letter (279x216 mm)</option>
            <option value="legal">Legal (356x216 mm)</option>
          </select>
        </div>
        <div>
          <div class="pdf-opt-label">Margin</div>
          <div class="pdf-opt-group">
            <button type="button" class="pdf-opt-btn active" data-margin="none" id="marginNone">No margin</button>
            <button type="button" class="pdf-opt-btn" data-margin="small" id="marginSmall">Small</button>
            <button type="button" class="pdf-opt-btn" data-margin="big" id="marginBig">Big</button>
          </div>
        </div>
        <div>
          <input type="checkbox" class="pdf-checkbox" id="mergeAll" checked/>
          <label for="mergeAll" style="font-size:1.05em;">Merge all images in one PDF file</label>
        </div>
        <button class="pdf-main-btn" id="convertBtn" disabled>
          Convert to PDF <span style="font-size:1.2em;">➔</span>
        </button>
      </form>
    </div>
    <a id="pdfDownloadLink" style="display:none"></a>
  </main>

  <!-- jsPDF & html2canvas CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script>
    // --- Image upload/preview ---
    const addImgBtn = document.getElementById('addImgBtn');
    const imgInput = document.getElementById('imgInput');
    const imgList = document.getElementById('imgList');
    const noImgMsg = document.getElementById('noImgMsg');
    let images = [];

    addImgBtn.onclick = () => imgInput.click();
    imgInput.onchange = e => {
      let files = Array.from(e.target.files);
      files.forEach(f => {
        if (f.type.startsWith("image/")) images.push(f);
      });
      renderImages();
    };

    function renderImages() {
      imgList.innerHTML = '';
      if (images.length === 0) {
        noImgMsg.style.display = '';
        document.getElementById('convertBtn').disabled = true;
        return;
      }
      noImgMsg.style.display = 'none';
      images.forEach((img, i) => {
        let div = document.createElement('div');
        div.className = 'img-item';
        let thumb = document.createElement('img');
        thumb.className = 'img-thumb';
        thumb.src = URL.createObjectURL(img);
        thumb.title = img.name;
        let fname = document.createElement('div');
        fname.className = 'img-filename';
        fname.textContent = img.name.length > 26 ? img.name.slice(0, 20)+'...' : img.name;
        let removeBtn = document.createElement('button');
        removeBtn.textContent = '✕';
        removeBtn.title = 'Remove';
        removeBtn.style = 'background:#ef4444;color:#fff;border:none;border-radius:6px;padding:0.2em 0.68em;font-size:1.1em;margin-top:0.4em;cursor:pointer;';
        removeBtn.onclick = () => {
          images.splice(i, 1);
          renderImages();
        };
        div.appendChild(thumb);
        div.appendChild(fname);
        div.appendChild(removeBtn);
        imgList.appendChild(div);
      });
      document.getElementById('convertBtn').disabled = false;
    }

    // --- PDF Options ---
    let orientation = "portrait";
    let pageSize = "a4";
    let margin = "none";
    document.querySelectorAll(".pdf-opt-btn[data-orient]").forEach(btn => {
      btn.onclick = function() {
        document.querySelectorAll(".pdf-opt-btn[data-orient]").forEach(b=>b.classList.remove('active'));
        this.classList.add('active');
        orientation = this.dataset.orient;
      }
    });
    document.getElementById('pageSize').onchange = function() {
      pageSize = this.value;
    };
    document.querySelectorAll(".pdf-opt-btn[data-margin]").forEach(btn => {
      btn.onclick = function() {
        document.querySelectorAll(".pdf-opt-btn[data-margin]").forEach(b=>b.classList.remove('active'));
        this.classList.add('active');
        margin = this.dataset.margin;
      }
    });

    // --- Convert to PDF ---
    document.getElementById('convertBtn').onclick = async function(e) {
      e.preventDefault();
      if (!images.length) return;
      const { jsPDF } = window.jspdf;
      let pdf = new jsPDF({
        orientation,
        unit: "mm",
        format: pageSize
      });
      let marginPx = margin === "none" ? 0 : (margin === "small" ? 10 : 24);

      for (let i = 0; i < images.length; i++) {
        if (i > 0 && document.getElementById('mergeAll').checked) pdf.addPage();
        let imgData = await fileToDataUrl(images[i]);
        let [pw, ph] = pdf.internal.pageSize.getWidthHeight();
        let img = new Image();
        img.src = imgData;
        await new Promise(res=>img.onload=res);
        // Fit image inside page with margin
        let scale = Math.min((pw - 2*marginPx) / img.width, (ph - 2*marginPx) / img.height);
        let iw = img.width * scale, ih = img.height * scale;
        let ix = (pw-iw)/2, iy = (ph-ih)/2;
        pdf.addImage(img, 'PNG', ix, iy, iw, ih);
        if (!document.getElementById('mergeAll').checked && i < images.length-1) pdf.save(images[i].name.replace(/\.[^/.]+$/, "")+'.pdf');
      }
      if (document.getElementById('mergeAll').checked) {
        pdf.save("images.pdf");
      }
    };

    function fileToDataUrl(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = e => resolve(e.target.result);
        reader.onerror = reject;
        reader.readAsDataURL(file);
      });
    }
  </script>
</body>
</html>
