<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Image to PDF Converter | ToolMancer</title>
  <link rel="stylesheet" href="../style.css"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;800&display=swap" rel="stylesheet">
  <!-- Include external CSS for drag/sort functionality if needed -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.css"/>
  <style>
    /* Add specific styles here or update style.css for tool layouts */
    .tool-page {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      padding-top: 2rem;
      flex-grow: 1;
      width: 100%;
    }
    .tool-page .tool-card {
      max-width: 1050px;
      padding: 2rem;
      width: 100%;
      box-shadow: 0 10px 25px -5px rgba(0,0,0,0.05);
      background: var(--card);
      border-radius: 12px;
      border: 1px solid var(--border-color);
    }
    .tool-header { text-align: center; margin-bottom: 1.5rem; }
    .tool-header h1 { font-size: 2rem; color: var(--accent); font-weight: 700; }
    .tool-header .tool-desc { font-size: 1rem; color: #475569; max-width: 650px; margin: 0 auto; line-height: 1.5; }
    [data-theme="dark"] .tool-header .tool-desc { color: #94a3b8; }

    /* --- PDF Layout Specifics --- */
    .pdf-tool-flex {
      display: flex;
      flex-wrap: wrap;
      gap: 2.2rem;
      justify-content: center;
      align-items: flex-start;
      margin-top: 1rem;
    }
    .pdf-images, .pdf-options {
      background: var(--bg); /* Use page background or a light card color */
      border-radius: 12px;
      border: 1px solid var(--border-color);
    }
    [data-theme="dark"] .pdf-images, [data-theme="dark"] .pdf-options { background: #2a374a; }

    .pdf-images {
      padding: 1rem;
      min-width: 340px;
      max-width: 420px;
      flex: 2 1 380px;
      position: relative;
    }
    .pdf-options {
      padding: 1.4rem;
      min-width: 220px;
      max-width: 350px;
      flex: 1 1 220px;
      display: flex;
      flex-direction: column;
      gap: 1.2em;
    }
    /* --- Upload Drop Zone --- */
    .upload-drop-zone {
      border: 2px dashed var(--accent);
      border-radius: 8px;
      background: var(--card);
      text-align: center;
      transition: border-color 0.2s, background 0.2s;
      padding: 1.5rem 1rem;
      margin-bottom: 1rem;
      cursor: pointer;
      font-size: 1.05em;
      color: var(--text);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    .upload-drop-zone:hover, .upload-drop-zone.active {
      border-color: #1e40af;
      background: #e0ebff;
    }
    [data-theme="dark"] .upload-drop-zone { background: #334155; }
    [data-theme="dark"] .upload-drop-zone:hover, [data-theme="dark"] .upload-drop-zone.active { background: #475569; border-color: #60a5fa; }
    .upload-drop-zone .add-icon { font-size: 2.5em; color: var(--accent); margin-bottom: 0.35em; pointer-events: none; }
    .upload-drop-zone input[type="file"] { display: none; }
    .upload-drop-zone .drop-hint { font-size:0.9em;color:#888;margin-top:0.5em;}
    /* --- Image preview list --- */
    .img-list { display: flex; flex-direction: column; align-items: stretch; gap: 1em; margin-top: 1em; }
    .img-item {
        display: flex;
        align-items: center;
        gap: 1em;
        background: var(--card);
        border-radius: 8px;
        box-shadow: 0 1px 4px rgba(0,0,0,0.05);
        border: 1px solid var(--border-color);
        padding: 0.6em;
        width: 100%;
        position: relative;
        cursor: move;
    }
    [data-theme="dark"] .img-item { background: #334155; }
    .img-thumb { border-radius: 6px; width: 50px; height: 50px; object-fit: cover; border: 1px solid #e2e8f0; }
    .img-filename { font-size: 0.9em; color: var(--text); flex-grow: 1; overflow-x: auto; white-space: nowrap; }
    .img-remove-btn {
        background: none;
        color: #ef4444;
        border: none;
        font-size: 1.1em;
        cursor: pointer;
        transition: color 0.2s;
    }
    .img-remove-btn:hover { color: #c81e1e; }
    .img-list.empty { color: #888; font-size: 1em; margin-top: 2em; text-align: center; }

    /* --- PDF Options Panel Styles --- */
    .pdf-opt-label { font-size: 0.95em; color: #475569; margin-bottom: 0.5em; font-weight: 500; }
    [data-theme="dark"] .pdf-opt-label { color: #94a3b8; }
    .pdf-opt-group { display: flex; gap: 0.5rem; }
    .pdf-opt-btn, .pdf-main-btn {
        padding: 0.7rem 1rem;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        border: 1px solid var(--border-color);
        transition: all 0.2s ease;
        background: var(--card);
        color: var(--text);
        flex: 1;
    }
    .pdf-opt-btn.active { background: var(--accent); color: white; border-color: var(--accent); }
    .pdf-main-btn { background: var(--accent); color: white; border: none; margin-top: 1rem; width: 100%; font-size: 1.1rem; }
    .pdf-opt-dropdown { width: 100%; padding: 0.7rem; border-radius: 8px; border: 1px solid var(--border-color); background: var(--card); color: var(--text); }
    .pdf-checkbox { width: 18px; height: 18px; margin-right: 0.5rem; }

    /* --- Results Section --- */
    .result-box {
        background: var(--card);
        border: 1px solid var(--border-color);
        border-radius: 12px;
        padding: 1.5rem;
        margin-top: 2rem;
        text-align: center;
    }
    .result-box button, .result-box a { margin: 0.5rem; } /* Add spacing between result buttons */

    /* --- How To Section --- */
    .how-to {
      max-width: 800px;
      margin-top: 2rem;
      padding: 1.5rem;
      background: var(--card);
      border-radius: 12px;
      border: 1px solid var(--border-color);
    }
    .how-to h3 { color: var(--text); margin-bottom: 1rem; }
    .how-to ol { list-style-position: inside; padding-left: 0; }
    .how-to li { margin-bottom: 0.5rem; color: #475569; }
    [data-theme="dark"] .how-to li { color: #94a3b8; }

    /* Mobile adjustments: Stack columns vertically for mobile devices */
    @media (max-width: 900px) {
      .pdf-tool-flex { flex-direction: column; gap: 1.2rem; align-items: stretch;}
      .pdf-images, .pdf-options { max-width: 100%; min-width: unset; }
      .pdf-tool-flex { padding: 0 1rem; } /* Add padding to flex container for better spacing on mobile */
      .upload-drop-zone { min-height: 100px; }
    }
    @media (max-width: 600px) {
      .pdf-images, .pdf-options { min-width: unset; }
      .img-thumb { width: 38px; }
      .img-filename { font-size: 0.9em; max-width: 150px;}
    }
  </style>
</head>
<body>

  <header class="main-header">
    <a href="../index.html" class="logo">ToolMancer</a>
    <button class="hamburger-btn" id="hamburgerBtn">‚ò∞</button>
    <nav class="main-nav">
      <ul>
        <li><a href="../index.html#category-image">Image Tools</a></li>
        <li><a href="../index.html#category-text">Text Tools</a></li>
        <li><a href="../blog.html">Blog</a></li>
      </ul>
      <button class="search-btn" id="searchBtn" aria-label="Search"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg></button>
      <button class="all-tools-btn" id="allToolsBtn">All Tools <span class="arrow">‚ñº</span></button>
      <button id="theme-toggle" class="theme-btn" aria-label="Toggle dark mode">üåô</button>
    </nav>
  </header>

  <div class="mega-menu" id="allToolsMenu">
    <div class="mega-menu-grid">
      <div class="mega-menu-category">
        <h3>Image Tools</h3>
        <ul>
            <li><a href="image-to-pdf.html"><span class="tool-icon">üìÑ</span> Image to PDF</a></li>
            <li><a href="image-compressor.html"><span class="tool-icon">üóúÔ∏è</span> Image Compressor</a></li>
            <li><a href="image-resizer.html"><span class="tool-icon">üìè</span> Image Resizer</a></li>
            <li><a href="convert-png-jpg.html"><span class="tool-icon">üñºÔ∏è</span> PNG <> JPG</a></li>
            <li><a href="steganography.html"><span class="tool-icon">üïµÔ∏è</span> Steganography</a></li>
        </ul>
      </div>
      <div class="mega-menu-category">
          <h3>Text & Writing</h3>
          <ul>
              <li><a href="text-diff.html"><span class="tool-icon">üîç</span> Text Diff</a></li>
              <li><a href="text-encryptor.html"><span class="tool-icon">üîê</span> Text Encryptor</a></li>
              <li><a href="text-to-pdf.html"><span class="tool-icon">üìÑ</span> Text to PDF</a></li>
              <li><a href="word-counter.html"><span class="tool-icon">‚úèÔ∏è</span> Word Counter</a></li>
          </ul>
      </div>
      <div class="mega-menu-category">
          <h3>Converters</h3>
          <ul>
              <li><a href="unit-converter.html"><span class="tool-icon">‚öñÔ∏è</span> Unit Converter</a></li>
              <li><a href="document-scanner.html"><span class="tool-icon">üìë</span> Document Scanner</a></li>
          </ul>
      </div>
      <div class="mega-menu-category">
          <h3>Encoder/Decoder</h3>
          <ul>
              <li><a href="url-encoder.html"><span class="tool-icon">üîó</span> URL Encoder</a></li>
              <li><a href="hash-generator.html"><span class="tool-icon">üõ°Ô∏è</span> Hash Generator</a></li>
              <li><a href="password-generator.html"><span class="tool-icon">üîë</span> Password Generator</a></li>
              <li><a href="qr-generator.html"><span class="tool-icon">üì±</span> QR Generator</a></li>
          </ul>
      </div>
      <div class="mega-menu-category">
          <h3>AI Tools</h3>
          <ul>
              <li><a href="image-to-prompt.html"><span class="tool-icon">ü§ñ</span> Image to Prompt</a></li>
              <li><a href="json-formatter.html"><span class="tool-icon">üß©</span> JSON Formatter</a></li>
          </ul>
      </div>
    </div>
  </div>

  <main class="content tool-page">
    <section class="tool-card">
      <header class="tool-header">
        <h1>üñºÔ∏è Image to PDF Converter</h1>
        <div class="tool-desc">Convert multiple images (JPG, PNG, etc.) into a single PDF ‚Äî privacy-friendly, works in your browser. Drag, reorder, and customize PDF output!</div>
      </header>
      <div class="pdf-tool-flex">
        <!-- Image area -->
        <div class="pdf-images" id="pdfImages">
          <div class="upload-drop-zone" id="dropZone">
            <span class="add-icon">+</span>
            <span style="font-weight:500;">Add images or drag & drop</span>
            <input type="file" id="imgInput" accept="image/*" multiple>
            <div class="drop-hint">Supported: JPG, PNG, WebP...</div>
          </div>
          <div class="img-list" id="imgList"></div>
          <div id="noImgMsg" class="img-list empty">No images selected</div>
        </div>
        <!-- PDF options panel -->
        <form class="pdf-options" id="pdfOptions" onsubmit="return false;">
          <div>
            <div class="pdf-opt-label">Page orientation</div>
            <div class="pdf-opt-group">
              <button type="button" class="pdf-opt-btn active" data-orient="portrait" id="orientPortrait">Portrait</button>
              <button type="button" class="pdf-opt-btn" data-orient="landscape" id="orientLandscape">Landscape</button>
            </div>
          </div>
          <div>
            <div class="pdf-opt-label">Page size</div>
            <select class="pdf-opt-dropdown" id="pageSize">
              <option value="a4">A4 (297x210 mm)</option>
              <option value="letter">Letter (279x216 mm)</option>
              <option value="legal">Legal (356x216 mm)</option>
            </select>
          </div>
          <div>
            <div class="pdf-opt-label">Margin</div>
            <div class="pdf-opt-group">
              <button type="button" class="pdf-opt-btn active" data-margin="none" id="marginNone">No margin</button>
              <button type="button" class="pdf-opt-btn" data-margin="small" id="marginSmall">Small</button>
              <button type="button" class="pdf-opt-btn" data-margin="big" id="marginBig">Big</button>
            </div>
          </div>
          <div>
            <input type="checkbox" class="pdf-checkbox" id="mergeAll" checked/>
            <label for="mergeAll" style="font-size:1.05em;">Merge all images in one PDF file</label>
          </div>
          <!-- New: Quality Option (as suggested for improvement) -->
          <div>
            <div class="pdf-opt-label">Image Quality</div>
            <input type="range" id="qualitySlider" min="0.1" max="1.0" step="0.1" value="0.9">
            <span id="qualityValue" style="font-size: 0.9em;">90%</span>
          </div>

          <button class="pdf-main-btn" id="convertBtn" disabled>
            Convert to PDF <span style="font-size:1.2em;">‚ûî</span>
          </button>
        </form>
      </div>
      <section class="result-box" id="resultBox" style="display:none; text-align: center; margin-top: 2rem;">
        <h3>Result:</h3>
        <a id="downloadBtn" class="btn" download="output.pdf">‚¨áÔ∏è Download PDF</a>
        <button id="shareBtn" class="btn">Share PDF</button> <!-- New Share Button -->
        <button id="openBtn" class="btn">üîó Open in New Tab</button>
        <button id="copyLinkBtn" class="btn">üìã Copy Link</button>
      </section>
    </section>
    <section class="how-to">
      <h3>How to Use</h3>
      <ol>
        <li>Click anywhere in the box or drag & drop images.</li>
        <li>Reorder if needed, set options.</li>
        <li>Click <b>Convert to PDF</b>.</li>
        <li>Download or open your PDF.</li>
        <li>(New) Share the file directly to your apps.</li>
      </ol>
    </section>
  </main>

  <!-- PWA Install Button -->
  <div class="pwa-install-container">
    <button class="btn" id="installButton" style="display:none;">Install App</button>
  </div>

  <footer class="main-footer">
    <ul class="footer-links">
        <li><a href="../about.html">About Us</a></li>
        <li><a href="../contact.html">Contact</a></li>
        <li><a href="../blog.html">Blog</a></li>
        <li><a href="../privacy.html">Privacy Policy</a></li>
        <li><a href="../disclaimer.html">Disclaimer</a></li>
    </ul>
    <p class="footer-copyright">&copy; 2025 ToolMancer. All Tools Run in Your Browser.</p>
  </footer>

  <!-- Scripts -->
  <script src="../theme.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- Navigation and Theme Toggle Logic ---
        const allToolsBtn = document.getElementById('allToolsBtn');
        const hamburgerBtn = document.getElementById('hamburgerBtn');
        const allToolsMenu = document.getElementById('allToolsMenu');
        const searchBtn = document.getElementById('searchBtn');

        const toggleMenu = (event) => { event.stopPropagation(); allToolsMenu.classList.toggle('show'); allToolsBtn.classList.toggle('open'); };
        allToolsBtn.addEventListener('click', toggleMenu);
        hamburgerBtn.addEventListener('click', () => {
            allToolsMenu.classList.toggle('show');
            document.body.classList.toggle('menu-open');
        });
        document.addEventListener('click', (event) => {
            if (window.innerWidth > 900) {
                if (allToolsMenu.classList.contains('show') && !allToolsMenu.contains(event.target) && !event.target.closest('.main-nav')) {
                    allToolsMenu.classList.remove('show'); allToolsBtn.classList.remove('open');
                }
            } else {
                if (allToolsMenu.classList.contains('show') && !allToolsMenu.contains(event.target) && event.target !== hamburgerBtn) {
                    allToolsMenu.classList.remove('show');
                    document.body.classList.remove('menu-open');
                }
            }
        });

        // --- PWA Install Logic ---
        let deferredPrompt;
        const installButton = document.getElementById('installButton');

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            installButton.style.display = 'block';
        });

        installButton.addEventListener('click', () => {
            installButton.style.display = 'none';
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    console.log('User response to install prompt:', choiceResult.outcome);
                    deferredPrompt = null;
                });
            }
        });

        window.addEventListener('appinstalled', () => {
            installButton.style.display = 'none';
        });

        // --- Tool Specific Logic ---
        const dropZone = document.getElementById('dropZone');
        const imgInput = document.getElementById('imgInput');
        const imgList = document.getElementById('imgList');
        const noImgMsg = document.getElementById('noImgMsg');
        const convertBtn = document.getElementById('convertBtn');
        const resultBox = document.getElementById('resultBox');
        const downloadBtn = document.getElementById('downloadBtn');
        const shareBtn = document.getElementById('shareBtn'); // New share button element
        const openBtn = document.getElementById('openBtn');
        const copyLinkBtn = document.getElementById('copyLinkBtn');
        const qualitySlider = document.getElementById('qualitySlider');
        const qualityValue = document.getElementById('qualityValue');

        let pdfBlobUrl = '';
        let images = [];

        // Full box click
        dropZone.addEventListener('click', (e) => {
          if (e.target === imgInput) return;
          imgInput.click();
        });
        // Drag & drop
        dropZone.addEventListener('dragover', e => {
          e.preventDefault();
          dropZone.classList.add('active');
        });
        dropZone.addEventListener('dragleave', () => dropZone.classList.remove('active'));
        dropZone.addEventListener('drop', e => {
          e.preventDefault();
          dropZone.classList.remove('active');
          handleFiles(e.dataTransfer.files);
        });
        imgInput.addEventListener('change', e => handleFiles(e.target.files));

        function handleFiles(files) {
          let filesArr = Array.from(files);
          filesArr.forEach(f => {
            if (f.type.startsWith("image/")) images.push({file: f, name: f.name, url: URL.createObjectURL(f)});
          });
          renderImages();
        }

        function renderImages() {
          imgList.innerHTML = '';
          if (!images.length) {
            noImgMsg.style.display = '';
            convertBtn.disabled = true;
            return;
          }
          noImgMsg.style.display = 'none';
          images.forEach((img, i) => {
            let div = document.createElement('div');
            div.className = 'img-item';
            div.setAttribute('data-index', i);
            let handle = document.createElement('span');
            handle.className = 'img-handle';
            handle.innerHTML = '‚ò∞';
            let thumb = document.createElement('img');
            thumb.className = 'img-thumb';
            thumb.src = img.url;
            thumb.title = img.name;
            let fname = document.createElement('div');
            fname.className = 'img-filename';
            fname.textContent = img.name.length > 24 ? img.name.slice(0, 20)+'...' : img.name;
            let removeBtn = document.createElement('button');
            removeBtn.className = 'img-remove-btn';
            removeBtn.textContent = '‚úï';
            removeBtn.title = 'Remove';
            removeBtn.onclick = () => {
              URL.revokeObjectURL(img.url);
              images.splice(i, 1);
              renderImages();
            };
            div.appendChild(handle);
            div.appendChild(thumb);
            div.appendChild(fname);
            div.appendChild(removeBtn);
            imgList.appendChild(div);
          });
          convertBtn.disabled = false;
          makeListSortable();
        }

        function makeListSortable() {
          Sortable.create(imgList, {
            handle: '.img-handle',
            animation: 170,
            onEnd: function (evt) {
              if (evt.oldIndex !== evt.newIndex) {
                const moved = images.splice(evt.oldIndex, 1)[0];
                images.splice(evt.newIndex, 0, moved);
                renderImages();
              }
            }
          });
        }

        // --- PDF Options ---
        let orientation = "portrait";
        let pageSize = "a4";
        let margin = "none";
        document.querySelectorAll(".pdf-opt-btn[data-orient]").forEach(btn => {
          btn.onclick = function() {
            document.querySelectorAll(".pdf-opt-btn[data-orient]").forEach(b=>b.classList.remove('active'));
            this.classList.add('active');
            orientation = this.dataset.orient;
          }
        });
        document.getElementById('pageSize').onchange = function() {
          pageSize = this.value;
        };
        document.querySelectorAll(".pdf-opt-btn[data-margin]").forEach(btn => {
          btn.onclick = function() {
            document.querySelectorAll(".pdf-opt-btn[data-margin]").forEach(b=>b.classList.remove('active'));
            this.classList.add('active');
            margin = this.dataset.margin;
          }
        });

        // Update quality value display
        qualitySlider.addEventListener('input', () => {
          qualityValue.textContent = Math.round(qualitySlider.value * 100) + '%';
        });

        // --- Convert to PDF ---
        convertBtn.onclick = async function(e) {
          e.preventDefault();
          if (!images.length) return;
          const { jsPDF } = window.jspdf;
          let pdf = new jsPDF({ orientation, unit: "mm", format: pageSize });
          let marginPx = margin === "none" ? 0 : (margin === "small" ? 10 : 24);
          let quality = parseFloat(qualitySlider.value);

          for (let i = 0; i < images.length; i++) {
            if (i > 0 && document.getElementById('mergeAll').checked) pdf.addPage();
            let imgData = await fileToDataUrl(images[i].file);
            let [pw, ph] = [pdf.internal.pageSize.getWidth(), pdf.internal.pageSize.getHeight()];
            let img = new Image();
            img.src = imgData;
            await new Promise(res=>img.onload=res);

            // Calculate scale factor to fit image within page boundaries with margins
            let scale = Math.min((pw - 2*marginPx) / img.width, (ph - 2*marginPx) / img.height);
            let iw = img.width * scale, ih = img.height * scale;
            let ix = (pw-iw)/2, iy = (ph-ih)/2;

            pdf.addImage(img, 'JPEG', ix, iy, iw, ih, null, null, quality);
          }

          if (document.getElementById('mergeAll').checked) {
            let blob = pdf.output('blob');
            if (pdfBlobUrl) URL.revokeObjectURL(pdfBlobUrl);
            pdfBlobUrl = URL.createObjectURL(blob);
            downloadBtn.href = pdfBlobUrl;

            // Prepare for sharing
            shareBtn.addEventListener('click', () => {
                shareFile(blob, 'application/pdf', 'output.pdf');
            });

            openBtn.onclick = () => window.open(pdfBlobUrl, '_blank');
            copyLinkBtn.onclick = () => {
              navigator.clipboard.writeText(pdfBlobUrl);
              copyLinkBtn.textContent = "‚úÖ Copied!";
              setTimeout(()=>copyLinkBtn.textContent="üìã Copy Link", 1200);
            };
            resultBox.style.display = 'block';
          }
        };

        function fileToDataUrl(file) {
          return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = e => resolve(e.target.result);
            reader.onerror = reject;
            reader.readAsDataURL(file);
          });
        }

        // --- Web Share API Logic ---
        async function shareFile(blob, type, filename) {
            if (navigator.share) {
                const file = new File([blob], filename, { type });
                try {
                    await navigator.share({
                        files: [file],
                        title: 'Converted PDF',
                        text: 'Sharing my PDF created with ToolMancer!'
                    });
                } catch (error) {
                    console.error('Error sharing:', error);
                    alert('Sharing failed: ' + error.message);
                }
            } else {
                alert('Web Share API not supported in this browser. Please use the download button.');
            }
        }
    });
  </script>
</body>
</html>
